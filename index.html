
<html>
  <body>
    test me 123
    <p id="demo"></p>
<button onclick="connectBT()">Click me</button>
    
<script>
  console.log("ttt");
document.getElementById("demo").innerHTML = "Hello JavaScript!";
</script> 
    
    <script>
      function connectBT() {
        console.log("testik");
        navigator.bluetooth.requestDevice({acceptAllDevices: true,  optionalServices: ['c1b25000-caaf-6d0e-4c33-7dae30052840']})
          .then(device => {
          // Human-readable name of the device.
          console.log(device.name);

          // Attempts to connect to remote GATT Server.
          return device.gatt.connect();
          })
          .then(server => { console.log("server ", server); 
            return server.getPrimaryService("c1b25000-caaf-6d0e-4c33-7dae30052840");})
          .then(service => {
            console.log("service ", service); 

            service.getCharacteristic("c1b25013-caaf-6d0e-4c33-7dae30052840")
              .then(ch =>{ console.log("notif char", ch); 
                    ch.startNotifications();
                    ch.addEventListener('characteristicvaluechanged',
                                  handleNotif); });
            // Getting Battery Level Characteristic...
            return service.getCharacteristic("c1b25012-caaf-6d0e-4c33-7dae30052840");
          })
          .then(characteristic => {
       
            console.log("characteristic ", characteristic); 
            var enc = new TextEncoder("utf-8");
            console.log(enc.encode("This is a string converted to a Uint8Array"));

            setInterval(function(){ console.log("tick"); 
            console.log("char", characteristic);
            //characteristic.writeValue(enc.encode("?\r")); 
            characteristic.writeValue(enc.encode("?\r")); 
            }
            , 3000);

            return characteristic.writeValue(enc.encode("?\r"));
          })
          .catch(error => { console.log(error); });

      }
      function handleNotif(event) {
        console.log("notified");
        console.log(event);
        let value = event.target.value;
        let a = [];
        // Convert raw data bytes to hex values just for the sake of showing something.
        // In the "real" world, you'd use data.getUint8, data.getUint16 or even
        // TextDecoder to process raw data bytes.
        for (let i = 0; i < value.byteLength; i++) {
          a.push('0x' + ('00' + value.getUint8(i).toString(16)).slice(-2));
        }
        console.log('> ' + a.join(' '));
        var decoder = new TextDecoder(utf-8);
        var decodedString = decoder.decode(value);
        console.log(decodedString);
      }
    </script>
  </body>
 </html>
